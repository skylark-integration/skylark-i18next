/**
 * skylark-i18next - A version of i18next.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-i18next/
 * @license MIT
 */
define(["./logger","./EventEmitter","./ResourceStore","./Translator","./LanguageUtils","./PluralResolver","./Interpolator","./BackendConnector","./defaults","./postProcessor","./utils"],function(e,t,s,i,n,o,a,r,l,h,g){"use strict";function c(){}class u extends t{constructor(s={},i){if(super(),g.isIE10&&t.call(this),this.options=l.transformOptions(s),this.services={},this.logger=e,this.modules={external:[]},i&&!this.isInitialized&&!s.isClone){if(!this.options.initImmediate)return this.init(s,i),this;setTimeout(()=>{this.init(s,i)},0)}}init(t={},h){function u(e){return e?"function"==typeof e?new e:e:null}if("function"==typeof t&&(h=t,t={}),t.whitelist&&!t.supportedLngs&&this.logger.deprecate("whitelist",'option "whitelist" will be renamed to "supportedLngs" in the next major - please make sure to rename this option asap.'),t.nonExplicitWhitelist&&!t.nonExplicitSupportedLngs&&this.logger.deprecate("whitelist",'options "nonExplicitWhitelist" will be renamed to "nonExplicitSupportedLngs" in the next major - please make sure to rename this option asap.'),this.options={...l.get(),...this.options,...l.transformOptions(t)},this.format=this.options.interpolation.format,h||(h=c),!this.options.isClone){this.modules.logger?e.init(u(this.modules.logger),this.options):e.init(null,this.options);const t=new n(this.options);this.store=new s(this.options.resources,this.options);const l=this.services;l.logger=e,l.resourceStore=this.store,l.languageUtils=t,l.pluralResolver=new o(t,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),l.interpolator=new a(this.options),l.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},l.backendConnector=new r(u(this.modules.backend),l.resourceStore,l,this.options),l.backendConnector.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.languageDetector&&(l.languageDetector=u(this.modules.languageDetector),l.languageDetector.init(l,this.options.detection,this.options)),this.modules.i18nFormat&&(l.i18nFormat=u(this.modules.i18nFormat),l.i18nFormat.init&&l.i18nFormat.init(this)),this.translator=new i(this.services,this.options),this.translator.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}this.modules.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(e=>{this[e]=((...t)=>this.store[e](...t))});["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(e=>{this[e]=((...t)=>(this.store[e](...t),this))});const d=g.defer(),p=()=>{this.changeLanguage(this.options.lng,(e,t)=>{this.isInitialized=!0,this.logger.log("initialized",this.options),this.emit("initialized",this.options),d.resolve(t),h(e,t)})};return this.options.resources||!this.options.initImmediate?p():setTimeout(p,0),d}loadResources(e,t=c){let s=t,i="string"==typeof e?e:this.language;if("function"==typeof e&&(s=e),!this.options.resources||this.options.partialBundledLanguages){if(i&&"cimode"===i.toLowerCase())return s();const e=[],t=t=>{if(!t)return;this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{e.indexOf(t)<0&&e.push(t)})};if(i)t(i);else{this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>t(e))}this.options.preload&&this.options.preload.forEach(e=>t(e)),this.services.backendConnector.load(e,this.options.ns,s)}else s(null)}reloadResources(e,t,s){const i=g.defer();return e||(e=this.languages),t||(t=this.options.ns),s||(s=c),this.services.backendConnector.reload(e,t,e=>{i.resolve(),s(e)}),i}use(module){if(!module)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!module.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===module.type&&(this.modules.backend=module),("logger"===module.type||module.log&&module.warn&&module.error)&&(this.modules.logger=module),"languageDetector"===module.type&&(this.modules.languageDetector=module),"i18nFormat"===module.type&&(this.modules.i18nFormat=module),"postProcessor"===module.type&&h.addPostProcessor(module),"3rdParty"===module.type&&this.modules.external.push(module),this}changeLanguage(e,t){this.isLanguageChangingTo=e;const s=g.defer();this.emit("languageChanging",e);const i=(e,i)=>{i?(this.language=i,this.languages=this.services.languageUtils.toResolveHierarchy(i),this.translator.changeLanguage(i),this.isLanguageChangingTo=void 0,this.emit("languageChanged",i),this.logger.log("languageChanged",i)):this.isLanguageChangingTo=void 0,s.resolve((...e)=>this.t(...e)),t&&t(e,(...e)=>this.t(...e))},n=e=>{const t="string"==typeof e?e:this.services.languageUtils.getBestMatchFromCodes(e);t&&(this.language||(this.language=t,this.languages=this.services.languageUtils.toResolveHierarchy(t)),this.translator.language||this.translator.changeLanguage(t),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage(t)),this.loadResources(t,e=>{i(e,t)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(n):n(e):n(this.services.languageDetector.detect()),s}getFixedT(e,t){const s=(e,t,...i)=>{let n;return(n="object"!=typeof t?this.options.overloadTranslationOptionHandler([e,t].concat(i)):{...t}).lng=n.lng||s.lng,n.lngs=n.lngs||s.lngs,n.ns=n.ns||s.ns,this.t(e,n)};return"string"==typeof e?s.lng=e:s.lngs=e,s.ns=t,s}t(...e){return this.translator&&this.translator.translate(...e)}exists(...e){return this.translator&&this.translator.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=this.languages[0],i=!!this.options&&this.options.fallbackLng,n=this.languages[this.languages.length-1];if("cimode"===s.toLowerCase())return!0;const o=(e,t)=>{const s=this.services.backendConnector.state[`${e}|${t}`];return-1===s||2===s};if(t.precheck){const e=t.precheck(this,o);if(void 0!==e)return e}return!!this.hasResourceBundle(s,e)||(!this.services.backendConnector.backend||!(!o(s,e)||i&&!o(n,e)))}loadNamespaces(e,t){const s=g.defer();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach(e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}),this.loadResources(e=>{s.resolve(),t&&t(e)}),s):(t&&t(),Promise.resolve())}loadLanguages(e,t){const s=g.defer();"string"==typeof e&&(e=[e]);const i=this.options.preload||[],n=e.filter(e=>i.indexOf(e)<0);return n.length?(this.options.preload=i.concat(n),this.loadResources(e=>{s.resolve(),t&&t(e)}),s):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.languages&&this.languages.length>0?this.languages[0]:this.language),!e)return"rtl";return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>=0?"rtl":"ltr"}createInstance(e={},t){return new u(e,t)}cloneInstance(e={},t=c){const s={...this.options,...e,...{isClone:!0}},n=new u(s);return["store","services","language"].forEach(e=>{n[e]=this[e]}),n.services={...this.services},n.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},n.translator=new i(n.services,n.options),n.translator.on("*",(e,...t)=>{n.emit(e,...t)}),n.init(s,t),n.translator.options=n.options,n.translator.backendConnector.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},n}}return new u});
//# sourceMappingURL=sourcemaps/i18next.js.map
